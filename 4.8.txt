

DATAS SEGMENT PARA 'DATA'
     HRSPAR   LABEL BYTE
     MAXTHLEN DB    6
     ACTHLEN  DB    ?
     HRSFLD   DB    6 DUP(?)
     
     RATEPAR  LABEL BYTE
     MAXRLEN  DB    6
     ACTRLEN  DB    ?
     RATEFLD  DB    6 DUP(?)
     
     MESSG1   DB    'Hours worked?','$'
     MESSG2   DB    'Rate of pay?','$'
     MESSG3   DB    'Wage ='
     ASCWAGE  DB    14 DUP(30H),13,10,'$'
     
     MESSG4   DB    13,10,'Overflow!',13,10,'$'
     ADJUST   DW    ?
     BINVAL   DW    0
     BINHRS   DW    0
     BINRATE  DW    0
     BINS     DW    0
     DECIND   DB    0
     MULT10   DW    01
     NODEC    DW    0
     COL      DB    0
     ROW      DB    0
     SHIFT    DW    ?
     TENWD    DW    10
     TEMPDX   DW    ?
     TEMPAX   DW    ?
DATAS ENDS

STACKS SEGMENT PARA STACK 'STACK'
     DW 32 DUP(?)
STACKS ENDS

CODES SEGMENT  PARA 'CODE'
    BEGIN PROC FAR
    ASSUME CS:CODES,DS:DATAS,SS:STACKS,ES:DATAS
    PUSH DS
    SUB AX,AX
    PUSH AX
    
    MOV AX,DATAS
    MOV DS,AX
    MOV ES,AX
    
    MOV AX,0600H
    CALL Q10SCR
    CALL Q20CURS
    
    A20LOOP:
    CALL B10INPT
    CMP ACTHLEN,0
    JE A30
    CALL D10HOUR
    CALL E10RATE
    CALL F10MULT 
    CALL G10WAGE
    CALL K10DISP
    JMP A20LOOP
    A30:
    MOV AX,0600H
    CALL Q10SCR
    RET
    BEGIN ENDP
    
    B10INPT PROC NEAR
    LEA DX,MESSG1
    MOV AH,09H
    INT 21H
    LEA DX,HRSPAR
    MOV AH,0AH
    INT 21H
    CMP ACTHLEN,0
    JNE B20
    B20:
    MOV COL,25
    CALL Q20CURS
    LEA DX,MESSG2
    MOV AH,09H
    INT 21H
    LEA DX,RATEPAR
    MOV AH,0AH
    INT 21H
    RET
    B10INPT ENDP
  
    D10HOUR PROC NEAR
    MOV NODEC,0
    MOV CL,ACTHLEN
    SUB CH,CH
    LEA SI,HRSFLD-1
    ADD SI,CX
    CALL M10ASBI
    MOV AX,BINVAL
    MOV BINHRS,AX
    RET
    D10HOUR ENDP
   
    E10RATE PROC NEAR
    MOV CL,ACTRLEN
    SUB CH,CH
    LEA SI,RATEFLD-1
    ADD SI,CX
    CALL M10ASBI
    MOV AX,BINVAL
    MOV BINRATE,AX
    RET
    E10RATE ENDP

    F10MULT PROC NEAR
    MOV CX,07
    LEA DI,ASCWAGE
    MOV AX,3030H
    CLD
    REP STOSW
    MOV SHIFT,10
    MOV ADJUST,0
    MOV CX,NODEC
    CMP CL,06
    JA F40
    DEC CX
    DEC CX
    JLE F30
    MOV NODEC,02
    MOV AX,01
    F20:
    MUL TENWD
    LOOP F20
    MOV SHIFT,AX
    SHR AX,1
    MOV ADJUST,AX
    F30:
    MOV AX,BINHRS
    MUL BINRATE
    ADD AX,ADJUST
    ADC DX,0
    MOV TEMPDX,DX
    MOV TEMPAX,AX
    CMP ADJUST,0
    JZ F50
    MOV AX,DX
    MOV DX,0
    DIV SHIFT    
    MOV TEMPDX,AX
    MOV AX,TEMPAX
    DIV SHIFT
    MOV DX,TEMPDX
    MOV TEMPAX,AX       
    JMP F50
    F40:
    MOV AX,0
    MOV DX,0
    F50:
    RET
    F10MULT ENDP

    G10WAGE PROC NEAR
    LEA SI,ASCWAGE+11
    MOV BYTE PTR[SI],'.'
    ADD SI,NODEC
    G30:
    CMP BYTE PTR[SI],'.'
    JNE G35
    DEC SI
    G35:
    CMP DX,0
    JNZ G40
    CMP AX,0010
    JB G50
    G40:
    MOV AX,DX
    MOV DX,0
    DIV TENWD
    MOV TEMPDX,AX
    MOV AX,TEMPAX
    DIV TENWD
    MOV TEMPAX,AX
    OR DL,30H
    MOV [SI],DL
    DEC SI
    MOV DX,TEMPDX
    JMP G30
    G50:
    OR AL,30H
    MOV [SI],AL
    RET
    G10WAGE ENDP
    
    K10DISP PROC NEAR
    MOV COL,50
    CALL Q20CURS
    MOV CX,10
    LEA SI,ASCWAGE
    K20:
    CMP BYTE PTR[SI],30H
    JNE K30
    MOV BYTE PTR[SI],20H
    INC SI
    LOOP K20
    K30:
    LEA DX,MESSG3
    MOV AH,09
    INT 21H
    CMP ROW,20
    JAE K80
    INC ROW
    JMP K90
    K80:
    MOV AX,0601H
    CALL Q10SCR
    MOV COL,0
    CALL Q20CURS
    K90:
    RET
    K10DISP ENDP
    
      
    M10ASBI PROC NEAR
    MOV MULT10,01
    MOV BINVAL,0
    MOV DECIND,0
    SUB BX,BX
    M20:
    MOV AL,[SI]
    CMP AL,'.'
    JNE M40
    MOV DECIND,01
    JMP M90
    M40:
    AND AX,000FH
    MUL MULT10
    JC OVERFLOW
    ADD BINVAL,AX
    JC OVERFLOW
    MOV AX,MULT10
    MUL TENWD
    MOV MULT10,AX
    CMP DECIND,0
    JNZ M90
    INC BX
    M90:
    DEC SI
    LOOP M20
    CMP DECIND,0
    JZ M100
    ADD NODEC,BX
    JMP M100
    OVERFLOW:
    MOV BINVAL,0
    M100:
    RET
    M10ASBI ENDP
       
    Q10SCR PROC NEAR
    MOV BH,07
    SUB CX,CX
    MOV DX,184FH
    INT 10H
    RET
    Q10SCR ENDP  
  
    Q20CURS PROC NEAR
    MOV AH,02
    SUB BH,BH
    MOV DH,ROW
    MOV DL,COL
    INT 10H
    RET
    Q20CURS ENDP
    
CODES ENDS
    END BEGIN





